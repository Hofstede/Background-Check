/* BackgroundCheck
   http://kennethcachia.com/background-check
   v1.2.0 */

!function(a,b){"function"==typeof define&&define.amd?define(b):a.BackgroundCheck=b(a)}(this,function(){"use strict";function a(a){if(void 0===a||void 0===a.targets)throw"Missing attributes";B.debug=a.debug||!1,B.debugOverlay=a.debugOverlay||!1,B.targets=e(a.targets),B.images=e(a.images||"img",!0),B.changeParent=a.changeParent||!1,B.threshold=a.threshold||50,B.minComplexity=a.minComplexity||30,B.minOverlap=a.minOverlap||50,B.windowEvents=a.windowEvents||!0,B.maxDuration=a.maxDuration||500,B.mask=a.mask||{r:0,g:255,b:0},B.classes=a.classes||{dark:"background--dark",light:"background--light",complex:"background--complex"},void 0===v&&(f(),v&&(w.style.position="fixed",w.style.top="0px",w.style.left="0px",w.style.width="100%",w.style.height="100%",window.addEventListener(A,s.bind(null,function(){i(),r()})),window.addEventListener("scroll",s.bind(null,r)),i(),r()))}function b(){v=null,w=null,x=null,B={},y&&clearTimeout(y)}function c(a){u("debug")&&console.log(a)}function d(a){for(var b,d,e=[],f=0;f<a.length;f++)if(b=a[f],e.push(b),"IMG"!==b.tagName){if(d=window.getComputedStyle(b).backgroundImage,d.split(",").length>1)throw"Multiple backgrounds are not supported";if(!d||"none"===d)throw"Element is not an <img> but does not have a background-image";e[f]={img:new Image,el:e[f]},e[f].img.src=d.slice(4,-1),c("CSS Image - "+d)}return e}function e(a,b){var c=a;if("string"==typeof a?c=document.querySelectorAll(a):1===a.nodeType&&(c=[a]),!c||0===c.length)throw"Elements not found";return b&&(c=d(c)),c}function f(){w=document.createElement("canvas"),w&&w.getContext?(x=w.getContext("2d"),v=!0):v=!1,g()}function g(){u("debugOverlay")?(w.style.opacity=.5,w.style.pointerEvents="none",document.body.appendChild(w)):w.remove()}function h(a){var d=(new Date).getTime()-a;c("Duration: "+d+"ms"),d>u("maxDuration")&&(console.log("BackgroundCheck - Killed"),n(),b())}function i(){z={left:0,top:0,right:document.body.clientWidth,bottom:window.innerHeight},w.width=document.body.clientWidth,w.height=window.innerHeight}function j(a,b,c){var d,e;return-1!==a.indexOf("px")?d=parseFloat(a):-1!==a.indexOf("%")?(d=parseFloat(a),e=d/100,d=e*b,c&&(d-=c*e)):d=b,d}function k(a){var b=window.getComputedStyle(a.el),c=b.backgroundSize.split(" "),d=b.backgroundPosition.split(" "),e=b.backgroundPositionX,f=b.backgroundPositionY,g=a.el.clientWidth/a.el.clientHeight,h=a.img.naturalWidth/a.img.naturalHeight,i=c[0],k=void 0===c[1]?"auto":c[1];return a.el.style.backgroundRepeat="no-repeat",a.el.style.backgroundOrigin="padding-box","cover"===i?g>=h?(i="100%",k="auto"):(i="auto",c[0]="auto",k="100%"):"contain"===i&&(1/h>1/g?(i="auto",c[0]="auto",k="100%"):(i="100%",k="auto")),i="auto"===i?a.img.naturalWidth:j(i,a.el.clientWidth),k="auto"===k?i/a.img.naturalWidth*a.img.naturalHeight:j(k,a.el.clientHeight),"auto"===c[0]&&"auto"!==c[1]&&(i=k/a.img.naturalHeight*a.img.naturalWidth),e=j(e,a.el.clientWidth,i),f=j(f,a.el.clientHeight,k),4===d.length&&("right"===d[0]&&(e=a.el.clientWidth-a.img.naturalWidth-e),"bottom"===d[2]&&(f=a.el.clientHeight-a.img.naturalHeight-f)),e+=a.el.getBoundingClientRect().left,f+=a.el.getBoundingClientRect().top,{left:e,right:e+i,top:f,bottom:f+k,width:i,height:k}}function l(a){var b,c,d,e,f;return a.nodeType?(b=a.getBoundingClientRect(),d=a.parentNode,c=a,b={top:b.top,width:b.width,left:b.left,right:b.right,height:b.height,bottom:b.bottom}):(b=k(a),d=a.el,c=a.img),d=d.getBoundingClientRect(),b.imageTop=0,b.imageLeft=0,b.imageWidth=c.naturalWidth,b.imageHeight=c.naturalHeight,e=b.imageHeight/b.height,b.top<d.top&&(f=d.top-b.top,b.imageTop=e*f,b.imageHeight-=e*f,b.top+=f,b.height-=f),b.left<d.left&&(f=d.left-b.left,b.imageLeft+=e*f,b.imageWidth-=e*f,b.width-=f,b.left+=f),b.bottom>d.bottom&&(f=b.bottom-d.bottom,b.imageHeight-=e*f,b.height-=f),b.right>d.right&&(f=b.right-d.right,b.imageWidth-=e*f,b.width-=f),b}function m(a){var b=l(a);a=a.nodeType?a:a.img,x.drawImage(a,b.imageLeft,b.imageTop,b.imageWidth,b.imageHeight,b.left,b.top,b.width,b.height)}function n(a){for(var b,c=a?[a]:u("targets"),d=0;d<c.length;d++)b=c[d],b=u("changeParent")?b.parentNode:b,b.classList.remove(u("classes").light),b.classList.remove(u("classes").dark),b.classList.remove(u("classes").complex)}function o(a){var b,d,e,f,g=a.getBoundingClientRect(),h=0,i=0,j=0,k=0,l=u("mask");if(g.width>0&&g.height>0){n(a),a=u("changeParent")?a.parentNode:a,d=x.getImageData(g.left,g.top,g.width,g.height).data;for(var m=0;m<d.length;m+=4)d[m]===l.r&&d[m+1]===l.g&&d[m+2]===l.b?k++:(h++,b=.2126*d[m]+.7152*d[m+1]+.0722*d[m+2],e=b-j,i+=e*e,j+=e/h);k<=d.length/4*(1-u("minOverlap")/100)&&(f=Math.sqrt(i/h)/255,j/=255,c("Target: "+a.className+" lum: "+j+" var: "+f),a.classList.add(j<=u("threshold")/100?u("classes").dark:u("classes").light),f>u("minComplexity")/100&&a.classList.add(u("classes").complex))}}function p(a,b){return a=(a.nodeType?a:a.el).getBoundingClientRect(),b=b===z?b:b.getBoundingClientRect(),!(a.right<b.left||a.left>b.right||a.top>b.bottom||a.bottom<b.top)}function q(a){for(var b,c=(new Date).getTime(),d=a&&"IMG"===a.tagName?"image":"targets",e=a?!1:!0,f=u("targets").length,g=0;f>g;g++)b=u("targets")[g],p(b,z)&&("targets"!==d||a&&a!==b?"image"===d&&p(b,a)&&o(b):(e=!0,o(b)));if("targets"===d&&!e)throw a+" is not a target";h(c)}function r(a,b,d){var e,f=!1,g=u("mask"),h=d?[d]:u("images");if(c("--- BackgroundCheck ---"),c("Loading: "+f),c("onLoad event: "+(d&&d.src)),v){b!==!0&&(x.clearRect(0,0,w.width,w.height),x.fillStyle="rgb("+g.r+", "+g.g+", "+g.b+")",x.fillRect(0,0,w.width,w.height));for(var i=0;i<h.length;i++)e=h[i],p(e,z)&&(0===e.naturalWidth?(f=!0,c("Loading... "+e.src),e.addEventListener("load",r.bind(null,a,!0,e))):(c("Drawing: "+e.src),m(e)));d||f?d&&q(d):q(a)}}function s(a){u("windowEvents")===!0&&(y&&clearTimeout(y),y=setTimeout(a,200))}function t(a,b){if(void 0===B[a])throw"Unknown property - "+a;if(void 0===b)throw"Missing value for "+a;if("targets"===a||"images"===a)try{b=e("images"!==a||b?b:"img","images"===a?!0:!1)}catch(c){throw b=[],c}n(),B[a]=b,r(),"debugOverlay"===a&&g()}function u(a){if(void 0===B[a])throw"Unknown property - "+a;return B[a]}var v,w,x,y,z,A=void 0!==window.orientation?"orientationchange":"resize",B={};return{init:a,destroy:b,refresh:r,set:t,get:u}});